{% extends "finance/base.html" %}
{% load static %}
{% block content %}

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Controle Financeiro</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light p-4">

<div class="container">
  <div class="text-center mb-4">
    <h1>üí∞ Controle Financeiro</h1>
     
    <!-- Bot√£o de adicionar transa√ß√£o -->
    <button type="button" class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#modalNovaTransacao{{ t.id }}" title="nova_transacao">
      + Nova Transa√ß√£o
    </button>

  </div>

  <div class="row text-center mb-4">
    <div class="col-md-4">
      <div class="card border-success">
        <div class="card-body">
          <h5 class="card-title text-success">Entradas</h5>
          <p class="fs-4">R$ {{ total_entradas|floatformat:2 }}</p>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card border-danger">
        <div class="card-body">
          <h5 class="card-title text-danger">Despesas</h5>
          <p class="fs-4">R$ {{ total_despesas|floatformat:2 }}</p>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card border-info">
        <div class="card-body">
          <h5 class="card-title text-info">Saldo</h5>
          <p class="fs-4 {% if saldo < 0 %}text-danger{% else %}text-success{% endif %}">
            R$ {{ saldo|floatformat:2 }}
          </p>
        </div>
      </div>
    </div>
  </div>

  <div class="card shadow">
    <div class="card-body">
      <h4 class="mb-3">üìã Transa√ß√µes</h4>

      <table class="table table-striped">
        <thead>
          <tr>
            <th>Descri√ß√£o</th>
            <th>Valor</th>
            <th>Data</th>
            <th>Categoria</th>
            <th>Pago?</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          {% for t in transacoes %}
          <tr>
            <td>{{ t.descricao }}</td>
            <td>R$ {{ t.valor|floatformat:2 }}</td>
            <td>{{ t.data }}</td>
            <td>{{ t.get_categoria_display }}</td>
            <td>{% if t.pago %}‚úÖ{% else %}‚ùå{% endif %}</td>
            <td>
              <!-- Bot√£o de editar -->
              <button type="button" class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#modalEditar{{ t.id }}" title="Editar Transa√ß√£o">
                ‚úèÔ∏è
              </button>

              <!-- Bot√£o de excluir -->
              <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#modalExcluir{{ t.id }}" title="Confirmar Exclus√£o">
                üóëÔ∏è
              </button>
              <!--Modal Nova Transa√ß√£o-->
            
                <div class="modal fade" id="modalNovaTransacao" tabindex="-1" aria-labelledby="modalNovaTransacaoLabel" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                      <form method="POST" action="{% url 'nova_transacao' %}">
                        {% csrf_token %} 
                        <div class="modal-header">
                          <h5 class="modal-title" id="modalNovaTransacaoLabel">Nova Transa√ß√£o</h5>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                        </div>
                        <div class="modal-body">
                          <div class="mb-3">
                            <label>Descri√ß√£o</label>
                            <input type="text" name="descricao" class="form-control" required>
                          </div>
                          <div class="mb-3">
                            <label>Valor</label>
                            <input type="number" step="0.01" name="valor" class="form-control" required>
                          </div>
                          <div class="mb-3">
                            <label>Data</label>
                            <input type="date" name="data" class="form-control" required>
                          </div>
                          <div class="mb-3">
                            <label>Categoria</label>
                            <select name="categoria" class="form-select" required>
                              <option value="receita">Receita</option>
                              <option value="despesa">Despesa</option>
                            </select>
                          </div>
                          <div class="mb-3 form-check">
                            <input type="checkbox" name="pago" class="form-check-input" id="pagoNova">
                            <label class="form-check-label" for="pagoNova">Pago?</label>
                          </div>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                          <button type="submit" class="btn btn-success">Salvar</button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>




              <!-- Modal de edi√ß√£o -->
              <div class="modal fade" id="modalEditar{{ t.id }}" tabindex="-1" aria-labelledby="modalEditarLabel{{ t.id }}" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content">
                    <form method="POST">
                      {% csrf_token %}
                      <input type="hidden" name="transacao_id" value="{{ t.id }}">
                      <div class="modal-header">
                        <h5 class="modal-title" id="modalEditarLabel{{ t.id }}">Editar Transa√ß√£o</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                      </div>
                      <div class="modal-body">
                        <div class="mb-3">
                          <label>Descri√ß√£o</label>
                          <input type="text" name="descricao" class="form-control" value="{{ t.descricao }}" required>
                        </div>
                        <div class="mb-3">
                          <label>Valor</label>
                          <input type="number" step="0.01" name="valor" class="form-control" value="{{ t.valor }}" required>
                        </div>
                        <div class="mb-3">
                          <label>Data</label>
                          <input type="date" name="data" class="form-control" value="{{ t.data|date:'Y-m-d' }}" required>
                        </div>
                        <div class="mb-3">
                          <label>Categoria</label>
                          <select name="categoria" class="form-select" required>
                            <option value="receita" {% if t.categoria == 'receita' %}selected{% endif %}>Receita</option>
                            <option value="despesa" {% if t.categoria == 'despesa' %}selected{% endif %}>Despesa</option>
                          </select>
                        </div>
                        <div class="mb-3 form-check">
                          <input type="checkbox" name="pago" class="form-check-input" id="pago{{ t.id }}" {% if t.pago %}checked{% endif %}>
                          <label class="form-check-label" for="pago{{ t.id }}">Pago?</label>
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-success">Salvar</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>

              <!-- Modal de exclus√£o -->
              <div class="modal fade" id="modalExcluir{{ t.id }}" tabindex="-1" aria-labelledby="modalExcluirLabel{{ t.id }}" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="modalExcluirLabel{{ t.id }}">Confirmar exclus√£o</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                    </div>
                    <div class="modal-body">
                      Tem certeza que deseja excluir a transa√ß√£o <strong>"{{ t.descricao }}"</strong>?
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                      <a href="{% url 'excluir_transacao' t.id %}" class="btn btn-danger">Excluir</a>
                    </div>
                  </div>
                </div>
              </div>

            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-center text-muted">Nenhuma transa√ß√£o cadastrada ainda.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
{% endblock %}