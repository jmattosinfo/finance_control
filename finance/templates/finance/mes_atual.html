{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Controle Mensal {{ mes }}/{{ ano }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <div class="container mt-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <a href="{% url 'mes_atual' ano=ano_anterior mes=mes_anterior %}" class="btn btn-outline-primary">⬅️ Mês anterior</a>
        <h1>Controle Mensal - {{ mes }}/{{ ano }}</h1>
        <a href="{% url 'mes_atual' ano=ano_proximo mes=mes_proximo %}" class="btn btn-outline-primary">Próximo mês ➡️</a>
      </div>

      <h1>Controle Mensal - {{ mes }}/{{ ano }}</h1>

      <h3>Totais do mês</h3>
      <ul>
        <li>Entradas: {{ total_entradas }} (Previsto: {{ total_prev_entradas }})</li>
        <li>Saídas: {{ total_saidas }} (Previsto: {{ total_prev_saidas }})</li>
        <li>Guardar: {{ total_guardar }} (Previsto: {{ total_prev_guardar }})</li>
      </ul>

      <h3>Transações realizadas</h3>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Data</th>
            <th>Descrição</th>
            <th>Categoria</th>
            <th>Valor</th>
          </tr>
        </thead>
        <tbody>
          {% for t in transacoes %}
            <tr>
              <td>{{ t.data }}</td>
              <td>{{ t.descricao }}</td>
              <td>{{ t.categoria }}</td>
              <td>{{ t.valor }}</td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="4">Nenhuma transação neste mês</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      <h3>Previsões do mês</h3>
      <table class="table table-light">
        <thead>
          <tr>
            <th>Descrição</th>
            <th>Categoria</th>
            <th>Valor Previsto</th>
          </tr>
        </thead>
        <tbody>
          {% for p in previsoes %}
            <tr>
              <td>{{ p.descricao }}</td>
              <td>{{ p.categoria }}</td>
              <td>{{ p.valor_previsto }}</td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="3">Nenhuma previsão para este mês</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      <h3>Comparativo Gráfico</h3>
      <canvas id="graficoMes" width="400" height="200"></canvas>
    </div>

    <script>
const ctx = document.getElementById('graficoMes').getContext('2d');
const graficoMes = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: ['Receitas', 'Despesas', 'Guardar'],
        datasets: [
            {
                label: 'Realizado',
                data: [{{ total_entradas }}, {{ total_saidas }}, {{ total_guardar }}],
                backgroundColor: 'rgba(54, 162, 235, 0.5)'
            },
            {
                label: 'Previsto',
                data: [{{ total_prev_entradas }}, {{ total_prev_saidas }}, {{ total_prev_guardar }}],
                backgroundColor: 'rgba(255, 99, 132, 0.5)'
            }
        ]
    },
    options: {
        responsive: true,
        plugins: {
            legend: { position: 'top' },
            title: { display: true, text: 'Comparativo Previsão x Realizado' }
        }
    }
});
</script>
  </body>
</html>
